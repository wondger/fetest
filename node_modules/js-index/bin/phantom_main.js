var system = require("system");
var itemSep = "";
var nameFuncSep = "";


console.log(system.args.length);
if (system.args.length !== 5) {
	console.log("usage: phantomjs phantom_main.js jslibrary_file jslibrary_global itemSeperator nameFuncSeperator");
	phantom.exit(1);
} else {
    //phantom.exit(0);
    itemSep = system.args[3];
	nameFuncSep = system.args[4];
	
	loadScript(system.args[1], system.args[2]);	
}

function loadScript(path, entry) {
	phantom.injectJs(path);
	var root = window[entry];
	console.log(itemSep, entry, nameFuncSep, root);
	
	traverse(root, entry+".");
	phantom.exit(0);

}

function traverse(item, namespace) {
	if (typeof item === "object" || typeof item === "function") {
		for (var k in item) {
			if (item.hasOwnProperty(k)) {
				var type = typeof item[k];
				if (type === "function") {
					console.log(itemSep, namespace+k, nameFuncSep, item[k]);
				} else {
					traverse(item[k], namespace + k + ".");
				}

			}
		}
	}
}
